<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASCII Video</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
</head>
<body>
    <div id="asciiContainer"></div>

    <script>
        const density = "Ã‘@#W$9876543210?!abc;:+=-,._                                     ";
        let video;
        let asciiDiv;

        function setup() {
            noCanvas();
            asciiDiv = createDiv();
            
            // Load video from GitHub
            video = createVideo("https://raw.githubusercontent.com/19xx/asciivid_test1/main/asclowres.mp4", videoLoaded);
            video.size(64, 64);
            video.hide(); // Hide original video
            
            // Optimize performance for pixel reading
            let canvas = document.createElement('canvas');
            let ctx = canvas.getContext('2d', { willReadFrequently: true });
        }

        function videoLoaded() {
            video.volume(0); // Mute video
            console.log("Video Loaded!");

            // Require user interaction for autoplay
            video.mousePressed(() => {
                video.play();
            });

            // Attempt autoplay with delay (if allowed)
            setTimeout(() => {
                video.play().catch(error => console.log("Autoplay blocked:", error));
            }, 1000);
        }

        function draw() {
            if (video.loadedmetadata) {
                video.loadPixels();
                let asciiImage = "";

                for (let j = 0; j < video.height; j++) {
                    for (let i = 0; i < video.width; i++) {
                        const pixelIndex = (i + j * video.width) * 4;
                        const r = video.pixels[pixelIndex + 0];
                        const g = video.pixels[pixelIndex + 1];
                        const b = video.pixels[pixelIndex + 2];
                        const avg = (r + g + b) / 3;
                        const len = density.length;
                        const charIndex = Math.floor(map(avg, 0, 255, 0, len - 1));
                        const c = density.charAt(charIndex);
                        asciiImage += c === " " ? "&nbsp;" : c;
                    }
                    asciiImage += "<br/>";
                }
                
                asciiDiv.html(asciiImage);
            }
        }
    </script>
</body>
</html>
